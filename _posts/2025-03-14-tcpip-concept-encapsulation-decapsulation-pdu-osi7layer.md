---
layout: post
title: TCP/IP 4계층 &#35;1. 개념, 캡슐화, 비캡슐화, PDU, OSI 7계층
categories: Network
description: CS 지식의 정석 - 디자인패턴 네트워크 운영체제 데이터베이스 자료구조
date: 2025-03-14 12:27:00 +0900
---
데이터를 하나 보낸다고 해보자. 데이터를 보낼 때에는 무엇이 필요할까? 나의 주소가 필요하고, 상대방의 주소도 필요하다. 생각해보면 이 데이터가 중간에 오류 없이 갔는지를 체크하는 오류 체크 관련 기능도 필요하다. 이런 것 말고도 데이터를 올바르게 목적지까지 보내는 수많은 고민이 있을 것이다. 이러한 고민들이 담겨서 만들어진 것이 바로 <b>TCP/IP 4계층</b> 모델이다. 이러한 고민들을 해결하는 계층을 만들고, 내가 어떤 데이터를 보낸다고 했을 때 바로 보내는 것이 아니라 이 계층을 통해서 보내게끔 하는 것이다. 이 계층은 주소를 담당하고, 이 계층은 오류 체크를 담당하고.. 이렇게 각 계층마다 책임을 부여하고, 이 책임을 기반으로 올바르게 데이터를 보내게끔 한다.

<b>TCP/IP 4계층은 장치들이 인터넷 상에서 데이터를 주고받을 때 쓰는 독립적인 프로토콜의 집합을 의미한다.</b> TCP/IP는 TCP(Transmission Control Protocol) / IP(Internet Protocol)이라는 의미인데 인터넷을 통해 데이터를 보낼 때 주로 TCP와 IP를 이용해서 보내기 때문에 이런 용어를 가진다.

중요한 것은 <u>장치들이 인터넷 상에서 데이터를 주고받을 때 쓰는 독립적인 프로토콜의 집합이라는 것</u>이다.

<br>

<img src="https://github.com/user-attachments/assets/ca9663ac-4334-48a3-aa9f-fd793c4f029b" width="300px" />

Application 계층(SMTP, HTTP/HTTPS, FTP, SSH), Transport 계층(UDP, TCP), Internet 계층(IPv4/IPv6, ICMP, ARP), Network Access 계층(= Link 계층)이 있다.

각 계층에 대해 대략적으로 알아보겠다.

<br>
<hr>

## 애플리케이션 계층(application)

HTTP, SMTP, SSH, FTP가 대표적이며 웹 서비스, 이메일 등 <b>서비스를 실질적으로 사람들에게 제공하는 층</b>이다.

<img src="https://github.com/user-attachments/assets/bbab0258-7420-4c1c-a886-1a156117a728" width="170px" />

가령 Chrome 브라우저를 켜고 내가 가고 싶은 사이트 www.naver.com 을 입력한다. (네이버 같은 경우 https 이기는 하지만) http 로 서빙되는 사이트도 있다. 즉, 이런 브라우저라는 인터페이스를 통해서 http 라는 응용 계층의 서비스를 이용하는 것이다.

<br>
<hr>

## 전송 계층(transport)

TCP, UDP가 대표적이며 <b>애플리케이션 계층에서 받은 메시지를 기반으로 세그먼트 또는 데이터그램으로 데이터를 쪼개고 데이터가 오류 없이 순서대로 전달되도록 도움을 주는 층</b>이다.

브라우저를 통해서 http 를 입력했다고 해보자. 데이터를 요청하든 그냥 주소를 쳤든, 데이터를 보낸 것이다. 애플리케이션 계층(응용 계층)에서는 이것을 '메시지'라고 한다. 그런데 이 메시지는 그대로 원했던 목적지로 가는 것이 아니다. 쪼개져서 간다.

애플리케이션 계층 밑에 전송 계층이 있다. 메시지를 세그먼트나 데이터그램으로 쪼개는 것이다.

<br>
<hr>

## 인터넷 계층(network)

IP, ICMP, ARP가 대표적이며 <b>한 노드에서 다른 노드로 전송 계층에서 받은 세그먼트 또는 데이터그램을 패킷화 하여 목적지로 전송하는 역할을 담당</b>한다.

앞서 전송 계층에서 쪼개진 세그먼트가 인터넷 계층에서 패킷화 된다.

<br>
<hr>

## 링크 계층(link)

링크 계층은 전선, 광섬유, 무선 등으로 <b>데이터가 네트워크를 통해 물리적으로 전송되는 방식을 정의</b>한다.

<br>
<hr>

지금까지 알아본 것을 그림으로 보면 다음과 같다.

<img src="https://github.com/user-attachments/assets/64041dc7-fda5-4b89-8e5f-aba531238e0f" width="650px" />

데이터를 보낸다고 했을 때 주소도 있어야 하고, 에러 체크도 있어야 한다. 전송 계층에서는 오류 체크를 할 수 있고, 인터넷 계층은 목적지로 가게끔 하는 주소 역할을 한다.

데이터를 보낸다고 했을 때, <b>애플리케이션 계층 → 전송 계층 → 인터넷 계층 → 링크 계층 순서로 통해서 데이터가 가게 된다.</b>

<br>

그리고 이 <u>네 개 계층은 서로 독립적</u>이다. http에는 http1, http2, http3 가 있다. 이런 식으로 버전이 바뀌었다고 해서 브라우저를 다시 설치하는가? 그렇지 않다. 이러한 계층들은 서로 독립적이다. 서로 영향을 받지 않는 것이다.

Transport 계층은 TCP와 UDP가 대표적인데, 내가 http와 TCP를 사용한다고 해서 혹은, 내가 http와 UDP를 사용한다고 해서 브라우저를 다시 설치해야 하는 것이 발생하지 않는 것이다.

<br>
<hr>

## 캡슐화와 비캡슐화

네트워크에서 <b>캡슐화(encapsulation)란 송신자가 수신자에게 데이터를 보낼 때 데이터가 각 계층을 지나며 각 계층의 특징들이 담긴 헤더들이 붙여지는 과정</b>을 의미한다.

에를 들어 전송 계층은 TCP 헤더, 네트워크 계층은 IP 주소 헤더를 추가하는 것이다.

<b>비캡슐화(decapsulation)란 이 과정의 역과정</b>이다. 수신자 측에서는 이렇게 캡슐화된 데이터를 역순으로 제거하면서 응용 계층(application layer)까지 도달하는 것을 말한다.

<img src="https://github.com/user-attachments/assets/3e7c7293-a4b4-4206-88b5-c416fd9b7a4d" width="900px" />

전송 계층에서는 오류를 해결하고, 인터넷 계층에서는 주소를 해결하고...

이러한 역할들이 어떻게 부여되냐면, 헤더(header) 또는 트레일러(trailer)들이 추가되면서 이런 역할을 수행할 수 있게 된다. 위 그림을 보면, Transport Layer에는 Segment header가 붙고, 그 아래 Internet Layer에는 Packet header가 붙으며, 그 아래의 Link Layer에는 Frame header와 Frame trailer가 붙는다.

<br>
<hr>

## PDU

<b>PDU(protocol data unit)란 TCP/IP 4 계층을 기반으로 설명했을 때 각 계층의 데이터 단위를 의미한다.</b>

* 애플리케이션 계층 : <b>메시지</b>
* 전송 계층 : <b>세그먼트(TCP)</b>, <b>데이터그램(UDP)</b>
* 인터넷 계층 : <b>패킷</b>
* 링크 계층 : <b>프레임(데이터 링크 계층)</b>, <b>비트(물리 계층)</b>

세그먼트 : 적절한 크기로 쪼갠 조각 (세그먼트와 데이터그램의 의미는 같다.)

패킷 : 세그먼트에 SP와 DP가 포함된 IP 헤더가 붙은 형태의 조각

프레임 : MAC 주소 헤더와 CRC/체크섬 트레일러가 붙은 조각

<br>

다음은 IP 헤더에 대한 그림이다.

<img src="https://github.com/user-attachments/assets/2ac270e9-b85f-4230-8425-9585a21d879c" width="500px" />

중요한 것만 보자. Source IP Address(SP), Destination IP Address(DP)가 있다. 송신자의 IP 주소, 수신자의 IP 주소가 IP header에 담긴 것이다. 데이터를 보낸다고 했을 때 주소가 필요하다.

이런 식으로 인터넷 계층에 오게 되면, IP header가 붙여지면서 패킷화가 되고, 그러면서 주소라는 정보가 담기게 된다.

<br>

MAC 주소는 장치의 NIC라는 카드에 부착되는 것이다. 프레임은 MAC 주소 헤더와 CRC/체크섬 트레일러가 붙은 조각인데, 프레임은 다음과 같이 되어 있다.

<img src="https://github.com/user-attachments/assets/057c8364-22c4-4f42-8717-1b69bc96bae7" width="480px" />

MAC Header, LLC Header, Layer3 Protocol Data, MAC Trailer 로 구성되어 있다. Layer3 에서 받은 데이터가 들어와서 헤더와 트레일러가 추가되는 것인데, 그림 아랫부분에 CRC / CheckSum 그리고 MAC 주소가 붙은 것을 알 수 있다.

<br>
<hr>

## CRC / 체크섬 트레일러

<b>데이터의 오류 감지를 위한 수학적 함수가 적용된 값</b>. 링크의 오류(과도한 트래픽 등)로 인해 <u>데이터 손상을 감지하는 역할</u>을 한다.

우리가 데이터를 보낸다고 했을 때, 이 과정 안에서 트래픽이 폭주할 수 있다. 트래픽이 폭주하게 되면 데이터가 올바르게 보내지지 않을 수 있다. 이때 오류 검사를 해서 오류가 발생했는지를 확인하는 과정이 필요하다. 이 오류 검사를 할 때 근간이 되는 것이 <b>CRC라는 알고리즘</b>이다. 이 알고리즘을 기반으로 체크섬이라는 값을 만들어서 그 값을 기반으로 오류 검사를 하는 것이다.

CRC로 이루어진 체크섬이라는 값이 위 그림에서의 Frame Trailer에 들어간다.

참고로 모든 계층에 전달되는 데이터가 쪼개져서 '패킷'으로 전달된다고도 하는 것도 대강 맞는 말이나 PDU에 따라 부르는 게 더 맞는 표현이다.

<br>
<hr>

## OSI 7 계층

TCP/IP 4계층은 OSI 7계층 모델로 설명하기도 한다.

<img src="https://github.com/user-attachments/assets/7f589e04-a6d0-4831-aac4-c49867373216" width="500px" />

TCP/IP 계층과 달리 OSI 계층은 애플리케이션 계층을 세 개로 쪼개고 링크 계층을 데이터 링크 계층, 물리 계층으로 나눠서 표현하는 것이 다르며 인터넷 계층을 네트워크 계층으로 부른다는 점이 다르다.

TCP/IP 4계층과 OSI 7계층의 차이점에 대해 설명할 수 있어야 하겠다.