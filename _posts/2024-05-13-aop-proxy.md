---
layout: post
title: Proxy
categories: Spring-SpringBoot
date: 2024-05-13 17:39:00 +0900
---
Proxy는 대행자, 대리인이라는 뜻을 가지고 있다.

<b>프록시 서버(Proxy Server)</b>는 클라이언트가 자신을 통해서 다른 네트워크 서비스에 간접적으로 접속할 수 있게 해주는 컴퓨터 시스템이나 응용 프로그램을 가리킨다.

원래 같았으면 클라이언트와 서버는 다이렉트로 연결이 주고 받았었다.

그런데 보안상의 이유로 이렇게 다이렉트로 접근할 수 없게 할 수도 있다. 물론 클라이언트가 보안 모듈을 몽땅 컴퓨터에 깔면 되기는 하는데, 클라이언트들은 별로 깔고 싶어하지 않는다.

그러면 그 보안 모듈들이 깔려 있는 서버(Proxy Server)로 접근하면 되는 것이다.

보안 모듈이 깔려있는 이 프록시 서버에서 서버에 대신 접근을 해주는 것이다. 가령 재택 근무를 한다고 했을 때, 사내 서비스에 바로 접근하지 못할 수 있다. (인트라넷) 외부에서는 접근할 수 없다. 그래서 어딘가를 거쳐서 접근하는, 대신 해주는 친구가 필요하다.

그런데 내가 이렇게 '대신 해주는' 프록시 서버를 쓴다고 한들 '뭔가 이상한데?'를 느끼면 안 된다. 즉, 프록시를 통해서 들어가도 클라이언트는 무언가 코드를 변경하지 않고 동작을 하는 느낌을 잘 받아야 하는 것이다.

<br>

가령 넷플릭스에서 영상을 보려고 한다. 내가 한국에 있어서 넷플릭스 한국 서버에 접근을 했더니 영상이 몇개 안 나온다. 해외에서 볼 수 있는 영상들이 있는데 접근을 못 하는 것이다.

VPN이 프록시를 이용하는 기술이다.

즉, 프록시를 이용하면 접근 제어와 부가 기능 추가를 수행할 수 있는 것이다.

<br>

<hr>

<br>

이제 코드를 통해 프록시에 대해 알아보자.

우선 Programmer 클래스를 만들어보겠다. (이번에는 프록시에 집중하기 위해, 필드는 과감하게 생략하고 메서드 자체에 집중할 것이다.)

일단 프로그래머의 일상은 다음과 같이 네 개로 이뤄져 있다고 볼 수 있다.

```java
package com.ssafy.proxy;

import java.util.Random;

public class Programmer {
	// 필드는 과감히 생략!

	// 프로그래머의 일상
	public void coding() {
		System.out.println("컴퓨터를 부팅한다.");        // 이전에 수행해야 할 것
        System.out.println("열심히 코드를 작성한다.");   // 핵심 관심사항
        System.out.println("Git에 Push 한다.");         // 이상 없이 마무리가 되었을 때
        System.out.println("조퇴를 한다.");             // 예외 발생
	}

}
```

그러면 아까 말했던 시나리오 중에서 하나가 없다. <b>예외</b>가 없는 것이다. 예외를 위해서 예외 클래스를 하나 만들 것이다.

<br>

예외 클래스의 이름은 프로그래머가 아플 수 있다는 점에서 OuchException으로 명명하겠다. OuchException은 다음과 같다.

```java
package com.ssafy.proxy;

public class OuchException extends RuntimeException {

	private static final long serialVersionUID = 1L;
	
	public void handleException() {
		System.out.println("병원 가자~~");
	}

}
```

RuntimeException은 UncheckedException, Exception은 CheckedException이다.

<br>

이제 다시 Programmer 클래스의 코드에 OuchException을 적용해보겠다.

핵심 관심사항인 "열심히 코드를 작성한다."가 실행을 할 때 이슈가 발생할 수 있다. try ~ catch ~ finally 구문으로 감싸주겠다.

```java
package com.ssafy.proxy;

import java.util.Random;

public class Programmer {
	// 필드는 과감히 생략!

	// 프로그래머의 일상
	public void coding() {
		System.out.println("컴퓨터를 부팅한다."); // 이전에 수행해야 할 것
		try {
			System.out.println("열심히 코드를 작성한다."); // 핵심 관심사항
			if (new Random().nextBoolean()) {
				throw new OuchException();
			}
			System.out.println("Git에 Push 한다."); // 이상 없이 마무리가 되었을 때
		} catch (OuchException e) {
			e.handleException();
			System.out.println("조퇴를 한다."); // 예외 발생
		} finally {
			System.out.println("하루를 마무리한다."); // 모든 게 마무리가 되었을 때
		}
	}

}
```

아픈 것은 예고하고 아픈 것이 아니기 때문에, Random() 메서드를 이용하였다. 위와 같이 코드를 작성하면 랜덤으로 true 혹은 false를 돌려준다.

만약 이 예외가 동작하지 않았다면 정상적으로 "Git에 Push 한다."가 수행될 것이고, 그게 아니라면 catch 해서 "조퇴를 한다."가 수행될 것이다.