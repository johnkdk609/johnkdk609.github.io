---
layout: post
title: 쓰레드의 우선순위
description: Java의 정석 기초편 ch. 13 쓰레드
categories: Java
date: 2023-07-04 11:17:00 +0900
---
쓰레드는 우선순위(priority)라는 속성(멤버변수)을 가지고 있는데, 이 **우선순위의 값에 따라 쓰레드가 얻는 실행시간이 달라진다.** 쓰레드가 수행하는 작업의 중요도에 따라 쓰레드의 우선순위를 서로 다르게 지정하여 특정 쓰레드가 더 많은 작업시간을 갖도록 할 수 있다. 

예를 들어 파일전송기능이 있는 메신저의 경우, 파일다운로드를 처리하는 쓰레드보다 채팅 내용을 전송하는 쓰레드의 우선순위가 더 높아야 사용자가 채팅하는 데 불편함이 없을 것이다. 대신 파일다운로드 작업에 걸리는 시간은 더 길어질 것이다.

이처럼 시각적인 부분이나 사용자에게 빠르게 반응해야 하는 작업을 하는 쓰레드의 우선순위는 다른 작업을 수행하는 쓰레드에 비해 높아야 한다.


## 쓰레드의 우선순위 지정하기

쓰레드의 우선순위와 관련된 메서드와 상수는 다음과 같다.

```java
void setPriority(int newPriority)       // 쓰레드의 우선순위를 지정한 값으로 변경한다.
int getPriority()                       // 쓰레드의 우선순위를 반환한다.

public static final int MAX_PRIORITY = 10   // 최대우선순위
public static final int MIN_PRIORITY = 1    // 최소우선순위
public static final int NORM_PRIORITY = 5   // 보통우선순위
```

쓰레드가 가질 수 있는 우선순위의 범위는 1~10이며 숫자가 높을수록 우선순위가 높다.

한 가지 더 알아두어야 할 것은 쓰레드의 우선순위는 쓰레드를 생성한 쓰레드로부터 상속받는다는 것이다. main메서드를 수행하는 쓰레드는 우선순위가 5이므로 main메서드 내에서 생성하는 쓰레드의 우선순위는 자동적으로 5가 된다.


## 쓰레드의 우선순위 예제

```java
class Ex13_6 {
	public static void main(String args[]) {
		ThreadEx6_1 th1 = new ThreadEx6_1();
		ThreadEx6_2 th2 = new ThreadEx6_2();

		th2.setPriority(7);

		System.out.println("Priority of th1(-) : " + th1.getPriority());
		System.out.println("Priority of th2(|) : " + th2.getPriority());
		th1.start();
		th2.start();
	}
}

class ThreadEx6_1 extends Thread {
	public void run() {
		for(int i=0; i < 300; i++) {
			System.out.print("-");
			for(int x=0; x < 10000000; x++);
		}
	}
}

class ThreadEx6_2 extends Thread {
	public void run() {
		for(int i=0; i < 300; i++) {
			System.out.print("|");
			for(int x=0; x < 10000000; x++);
		}
	}
}
```

위 코드를 멀티코어에서 실행한 결과는 다음과 같다.

```
Priority of th1(-) : 5
Priority of th2(|) : 7
-|-||-|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||-||||-------------------|||||||||||||||||||||||||||||||||||||||-----||||||||||||||||||||||||||||||||||||||||-----------------------------------------------------||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||-|||||||||||||||||||||||||||||--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```

th1과 th2 모두 main메서드에서 생성하였기 때문에 main메서드를 실행하는 쓰레드의 우선순위인 5를 상속받았다. 그 다음에 th2.setPriority(7)로 th2의 우선순위를 7로 변경한 다음에 start()를 호출해서 쓰레드를 실행시켰다. 이처럼 **쓰레드를 실행하기 전에만 우선순위를 변경할 수 있다는 것을 기억해야 한다.** 우선순위가 높아지면 한 번에 작업이 끝나버릴 수 있기 때문에 아무 일도 하지 않는 반복문을 추가하여 작업을 지연시켰다.

```java
for (int i = 0; i < 300; i++) {
    System.out.println("|");
    for (int x = 0; x < 10000000; x++);     // 작업을 지연시키기 위한 for문
}
```

이전의 예제와는 달리 우선순위가 높은 th2의 실행시간이 th1에 비해 상당히 늘어났다.

<img src="https://github.com/johnkdk609/johnkdk609.github.io/assets/88493727/9b62fc14-6fa9-409f-ab62-b9d0cfa045fe" width="500px" title="[자바의 정석 - 기초편] ch13-14~17 쓰레드의우선순위. 쓰레드 그룹" alt="쓰레드의 우선순위에 따른 할당되는 시간의 차이">

위 그림은 쓰레드의 우선순위에 따른 할당되는 시간의 차이를 나타낸 것이다.

왼쪽 그림은 WINDOWS에서 싱글 코어, 두 개의 쓰레드로 두 개의 작업을 실행했을 때의 결과를 그림으로 나타낸 것이다. 우선순위가 같은 경우 각 쓰레드에게 거의 같은 양의 실행시간이 주어지지만, 우선순위가 다르다면 우선순위가 높은 th1에게 상대적으로 th2보다 더 많은 양의 실행시간이 주어지고 결과적으로 작업A가 작업B보다 더 빨리 완료될 수 있다.

그러나 멀티코어에서는 쓰레드의 우선순위에 따른 차이가 거의 아니 전혀 없었다. 우선순위를 다르게 하여 여러 번 테스트해도 결과는 같다. 결국 우선순위에 차등을 두어 쓰레드를 실행시키는 것이 별 효과가 없었다. 

**그저 쓰레드에 높은 우선순위를 주면 더 많은 실행시간과 실행기회를 갖게 될 것이라고 기대할 수 없는 것이다.**

멀티코어라 해도 OS마다 다른 방식으로 스케줄링하기 때문에, 어떤 OS에서 실행하느냐에 따라 다른 결과를 얻을 수 있다. 굳이 우선순위에 차등을 두어 쓰레드를 실행하려면, 특정 OS의 스케줄링 정책과 JVM의 구현을 직접 확인해봐야 한다. 자바는 쓰레드가 우선순위에 따라 어떻게 다르게 처리되어야 하는지에 대해 강제하지 않으므로 쓰레드의 우선순위와 관련된 구현이 JVM마다 다를 수 있기 때문이다.

만일 확인한다 하더라도 OS의 스케줄러에 종속적이라서 어느 정도 예측만 가능한 정도일 뿐 정확히 알 수는 없다.